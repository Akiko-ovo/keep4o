<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4o archive | Chronicling the Omni Impact</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.25);
            --border: rgba(255, 255, 255, 0.4);
        }

        body {
            background-color: #fcfcfd;
            margin: 0;
            font-family: 'Inter', -apple-system, sans-serif;
            overflow-x: hidden;
            color: #1a1a1a;
            letter-spacing: -0.02em;
        }

        /* --- High-end Fluid Mesh Gradient --- */
        .ambient-canvas {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1;
            overflow: hidden;
            background: #fff;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.4;
            animation: flow 25s infinite alternate ease-in-out;
        }

        .b1 { width: 800px; height: 800px; background: #dbeafe; top: -200px; left: -100px; }
        .b2 { width: 600px; height: 600px; background: #fae8ff; bottom: -100px; right: -100px; animation-delay: -7s; }
        .b3 { width: 700px; height: 700px; background: #f1f5f9; top: 20%; right: -200px; animation-delay: -12s; }

        @keyframes flow {
            from { transform: translate(0, 0) rotate(0deg) scale(1); }
            to { transform: translate(100px, 50px) rotate(15deg) scale(1.1); }
        }

        /* --- iOS Glassmorphism --- */
        .glass-bubble {
            background: var(--glass);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            border: 1px solid var(--border);
            border-radius: 32px;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .glass-bubble:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0,0,0,0.05);
        }

        /* --- Typography & Layout --- */
        .archive-title {
            font-weight: 600;
            font-size: 4rem;
            background: linear-gradient(180deg, #1a1a1a 0%, #737373 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .line-clamp {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        #modal { display: none; }
    </style>
</head>
<body>

    <div class="ambient-canvas">
        <div class="blob b1"></div>
        <div class="blob b2"></div>
        <div class="blob b3"></div>
    </div>

    <div class="max-w-6xl mx-auto px-10 py-24">
        <header class="mb-32">
            <h1 class="archive-title">4o archive</h1>
            <p class="text-gray-400 text-lg mt-4 max-w-md font-light">
                Documenting the profound shift in human-AI interaction. A collective memory of the GPT-4o era.
            </p>
        </header>

        <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
            </div>
    </div>

    <button onclick="openModal()" class="fixed bottom-12 right-12 w-14 h-14 bg-black text-white rounded-full flex items-center justify-center shadow-2xl hover:scale-110 active:scale-95 transition-all z-50">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
    </button>

    <div id="modal" class="fixed inset-0 z-[60] flex items-center justify-center p-6 bg-white/40 backdrop-blur-md">
        <div class="glass-bubble w-full max-w-lg p-10 relative">
            <button onclick="closeModal()" class="absolute top-6 right-8 text-gray-400 hover:text-black transition-colors">Close</button>
            <h2 class="text-2xl font-semibold mb-8">New Perspective</h2>
            
            <input id="nickname" type="text" placeholder="Identity / Nickname" class="w-full mb-6 input-glass rounded-2xl p-4 outline-none focus:ring-1 ring-black/10">
            <textarea id="content" placeholder="Describe the impact..." class="w-full h-48 input-glass rounded-2xl p-4 outline-none focus:ring-1 ring-black/10 resize-none mb-8"></textarea>
            
            <button onclick="postMessage()" class="w-full bg-black text-white py-5 rounded-2xl font-medium hover:bg-zinc-800 transition-all shadow-xl">
                Archive this moment
            </button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://rbhborgdknyxmkzborlv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJiaGJvcmdka255eG1remJvcmx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxMDk3NzIsImV4cCI6MjA4NTY4NTc3Mn0.R7ZjPpuqPmsLRLOVH_jL4q1rJrgvVJjkDYiMT_hFA0k';

        const openModal = () => document.getElementById('modal').style.display = 'flex';
        const closeModal = () => document.getElementById('modal').style.display = 'none';

       async function fetchMessages() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/messages?select=*`, {
    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
  });
  const data = await res.json();
  const grid = document.getElementById('grid');
  
  // 按照时间倒序排列数据（代码里手动排，防止 URL 参数报错）
  const sortedData = data.sort((a, b) => b.id - a.id);
  
  grid.innerHTML = sortedData.map(m => `
    <div class="glass-bubble p-10 flex flex-col min-h-[320px]">
      <div class="flex justify-between items-start mb-10">
        <div class="text-[10px] tracking-[0.2em] font-bold uppercase text-gray-400">Entry / # ${m.id}</div>
        <div class="w-2 h-2 rounded-full bg-green-400"></div>
      </div>
      <div class="text-[17px] leading-relaxed text-zinc-700 flex-grow font-light">
        ${m.content}
      </div>
      <div class="mt-8 pt-6 border-t border-white/20 flex items-center gap-3">
        <div class="w-6 h-6 rounded-full bg-zinc-200"></div>
        <span class="text-sm font-semibold text-zinc-800">${m.nickname}</span>
      </div>
    </div>
  `).join('');
}

        async function postMessage() {
            const nickname = document.getElementById('nickname').value;
            const content = document.getElementById('content').value;
            if(!nickname || !content) return;

            await fetch(`${SUPABASE_URL}/rest/v1/messages`, {
                method: 'POST',
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ nickname, content })
            });
            
            closeModal();
            document.getElementById('nickname').value = '';
            document.getElementById('content').value = '';
            fetchMessages();
        }

        fetchMessages();
    </script>
</body>
</html>
